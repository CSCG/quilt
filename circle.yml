machine:

  xcode:
    version: 8.2

  environment:
    TEST_REGISTRY: false
    QPYVER: 3.5

  pre:
    - curl -o mconda.sh https://repo.continuum.io/miniconda/Miniconda3-latest-MacOSX-x86_64.sh
    - chmod +x mconda.sh
    - ./mconda.sh -b -p $HOME/miniconda
    - export PATH="$HOME/miniconda/bin:$PATH"
    - echo $PATH
    - echo $(python --version)
    - $HOME/miniconda/bin/conda update conda 
    - $HOME/miniconda/bin/conda install python=3.5
    - $HOME/miniconda/bin/conda create --yes -n quilt_env python=3.5 pip
    - source $HOME/miniconda/bin/activate quilt_env
    - pip install pytest --user

dependencies:

  post:
    - echo -r "Installing dependency"
    - echo $(python --version)
    - pip install 'tables' ./compiler
    - if [[ "$TEST_REGISTRY" = true ]]; then
          pip install registry
      fi

test:
  override:
    - echo -r "Running Compiler/Registry Test with $(python --version)"
    - pytest compiler
    - if [[ "$TEST_REGISTRY" = true ]]; then
          pytest ./registry
      fi
