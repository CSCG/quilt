machine:

  xcode:
    version: 8.2

  environment:
    TEST_REGISTRY: false

  pre:
    - export PATH=/usr/local/bin:$PATH:/Users/distiller/Library/Python/2.7/bin
    - pip install --user --ignore-installed --upgrade virtualenv
    - ln -s $HOME/Library/Python/2.7/bin/virtualenv /usr/local/bin/virtualenv
    - cd "$(brew --repository)" && git fetch && git reset --hard origin/master
    - brew update
    - brew install pyenv
    - brew install python3
    - pyenv install 3.5.1
    - pyenv install 3.6.1

  post:
    - pyenv global 3.5.1 3.6.1

dependencies:
  override:
    - echo $(python --version)
    - sudo pip install -U pip
    - pip install --user
    - pip install -U numpy pytest

  post:
    - echo -r "Installing dependency"
    - sudo pip install --only-binary 'tables' ./compiler
    - if [[ "$TEST_REGISTRY" = true ]]; then
          pip install registry
      fi

test:
  override:
    - echo -r "Running Compiler/Registry Test with $(python --version)"
    - sudo pytest compiler
    - if [[ "$TEST_REGISTRY" = true ]]; then
          sudo pytest ./registry
      fi
