machine:

  xcode:
    version: 8.2

  environment:
    TEST_REGISTRY: false

  pre:
    - export PATH=/usr/local/bin:$PATH:/Users/distiller/Library/Python/2.7/bin
    - pip install --user --ignore-installed --upgrade virtualenv
    - ln -s $HOME/Library/Python/2.7/bin/virtualenv /usr/local/bin/virtualenv
    - cd "$(brew --repository)" && git fetch && git reset --hard origin/master
    - brew update
    - brew install pyenv
    - brew install python3
    - pyenv install 2.7.10
    - pyenv install 3.5.1

  post:
    - pyenv local 2.7.10 3.5.1

dependencies:
  override:
    - pyenv local 3.5.1
    - echo $(python --version)
    - sudo pip install -U pip
    - pip install numpy pytest --user -U
    - pip install --upgrade --user --ignore-installed setuptools wheel


  post:
    - echo -r "Installing dependency"
    - pip install --use-wheel --user --only-binary 'tables' ./compiler
    - if [[ "$TEST_REGISTRY" = true ]]; then
          pip install registry
      fi

test:
  override:
    - echo -r "Running Compiler/Registry Test with $(python --version)"
    - pytest compiler
    - if [[ "$TEST_REGISTRY" = true ]]; then
          pytest ./registry
      fi
