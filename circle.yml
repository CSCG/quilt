machine:

  xcode:
    version: 9.0

  environment:
    TEST_REGISTRY: false
    QPYVER: 3.5
    PATH: PATH="$HOME/miniconda/bin:$PATH"

  pre:
    - curl -o mconda.sh https://repo.continuum.io/miniconda/Miniconda3-latest-MacOSX-x86_64.sh
    - chmod +x mconda.sh
    - ./mconda.sh -b -p $HOME/miniconda
    - export PATH="$HOME/miniconda/bin:$PATH" && echo $PATH
    - $HOME/miniconda/bin/conda search "^python$"
    - export PATH="$HOME/miniconda/bin:$PATH"  && conda create --yes -n quilt_env python=3.5.1 pip
    - export PATH="$HOME/miniconda/bin:$PATH" && source activate quilt_env
    - find / -name pytest*

dependencies:

  post:
    - echo -r "Installing dependency"
    - export PATH="$HOME/miniconda/bin:$PATH" && python --version
    - export PATH="$HOME/miniconda/bin:$PATH" && ls $HOME/miniconda/lib/python3.6/site-packages
    - export PATH="$HOME/miniconda/bin:$PATH" && which pytest
    - export PATH="$HOME/miniconda/bin:$PATH" && pip install 'tables' ./compiler --user
    - if [[ "$TEST_REGISTRY" = "true" ]] ; then pip install registry ; fi

test:
  override:
    - echo -r "Running Compiler/Registry Test with $(python --version)"
    - export PATH="$HOME/miniconda/bin:$PATH" && pytest compiler
    - if [[ "$TEST_REGISTRY" = "true" ]] ; then pytest ./registry ; fi
